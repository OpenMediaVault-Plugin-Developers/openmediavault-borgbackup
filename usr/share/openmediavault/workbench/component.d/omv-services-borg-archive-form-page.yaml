version: "1.0"
type: component
data:
  name: omv-services-borgbackup-archive-form-page
  type: formPage
  config:
    request:
      service: BorgBackup
      get:
        method: getArchive
        params:
          uuid: "{{ _routeParams.uuid }}"
      post:
        method: setArchive
    fields:
      - type: confObjUuid
      - type: divider
        title: _("General")
      - type: checkbox
        name: enable
        label: _("Enable")
        value: true
      - type: textInput
        name: name
        label: _("Name/Prefix")
        validators:
          required: true
          patternType: shareName
        hint: _("Uses value as prefix for archive name.")
      - type: select
        name: reporef
        label: _("Repo")
        placeholder: _("Select a repo ...")
        textField: name
        valueField: uuid
        store:
          proxy:
            service: BorgBackup
            get:
              method: enumerateRepoCandidates
        validators:
          required: true
      - type: divider
        title: _("Backup Options")
      - type: select
        name: compressiontype
        label: _("Compression Type")
        value: "none"
        store:
          data:
            - ["none", _("None")]
            - ["zstd", _("zstd - super fast / medium compression")]
            - ["lz4", _("lz4 - super fast / low compression")]
            - ["zlib", _("zlib - less fast / higher compression")]
            - ["lzma", _("lzma - even slower / even higher compression")]
      - type: numberInput
        name: compressionratio
        label: _("Compression ratio")
        value: 9
        hint: _("0 is the fastest compression and 9 is the best compression")
        validators:
          min: 0
          max: 9
          patternType: integer
          required: true
      - type: checkbox
        name: onefs
        label: _("One filesystem only")
        value: false
        hint: _("If this is enabled, borg won't span filesystem partitions within a backup point.")
      - type: checkbox
        name: noatime
        label: _("No atime")
        value: false
      - type: textarea
        name: include
        label: _("Includes")
        hint: _("Put a new line or comma between each directory")
        value: ""
        validators:
          required: true
      - type: textarea
        name: exclude
        label: _("Excludes")
        hint: _("Put a new line or comma between each directory")
        value: ""
        validators:
          required: false
      - type: divider
        title: _("Retention and Schedule")
      - type: container
        fields:
          - type: numberInput
            name: hourly
            label: _("Retain hourly")
            value: 0
            hint: _("Number of hourly backups to keep.")
            validators:
              min: 0
              max: 999
              patternType: integer
              required: true
          - type: hidden
            name: empty
            value: false
            submitValue: false
          - type: numberInput
            name: hourlymin
            label: _("hourly minute")
            value: 5
            hint: _("Minute after the hour that hourly backups run.")
            validators:
              min: 0
              max: 59
              patternType: integer
              required: true
            modifiers:
              - type: visible
                constraint:
                  operator: ne
                  arg0:
                    prop: hourly
                  arg1: 0
      - type: container
        fields:
          - type: numberInput
            name: daily
            label: _("Retain daily")
            value: 7
            hint: _("Number of daily backups to keep.")
            validators:
              min: 0
              max: 999
              patternType: integer
              required: true
          - type: numberInput
            name: dailyhour
            label: _("daily hour")
            value: 3
            hint: _("Hour of the day that daily backups run.")
            validators:
              min: 0
              max: 23
              patternType: integer
              required: true
            modifiers:
              - type: visible
                constraint:
                  operator: ne
                  arg0:
                    prop: daily
                  arg1: 0
          - type: numberInput
            name: dailymin
            label: _("daily minute")
            value: 30
            hint: _("Minute after the hour that daily backups run.")
            validators:
              min: 0
              max: 59
              patternType: integer
              required: true
            modifiers:
              - type: visible
                constraint:
                  operator: ne
                  arg0:
                    prop: daily
                  arg1: 0
      - type: container
        fields:
          - type: numberInput
            name: weekly
            label: _("Retain weekly")
            value: 4
            hint: _("Number of weekly backups to keep.")
            validators:
              min: 0
              max: 999
              patternType: integer
              required: true
          - type: numberInput
            name: weeklyhour
            label: _("weekly hour")
            value: 3
            hint: _("Hour of the day that weekly backups run.")
            validators:
              min: 0
              max: 23
              patternType: integer
              required: true
            modifiers:
              - type: visible
                constraint:
                  operator: ne
                  arg0:
                    prop: weekly
                  arg1: 0
          - type: numberInput
            name: weeklymin
            label: _("weekly minute")
            value: 0
            hint: _("Minute after the hour that weekly backups run.")
            validators:
              min: 0
              max: 59
              patternType: integer
              required: true
            modifiers:
              - type: visible
                constraint:
                  operator: ne
                  arg0:
                    prop: weekly
                  arg1: 0
      - type: container
        fields:
          - type: numberInput
            name: monthly
            label: _("Retain monthly")
            value: 3
            hint: _("Number of monthly backups to keep.")
            validators:
              min: 0
              max: 999
              patternType: integer
              required: true
          - type: numberInput
            name: monthlyhour
            label: _("monthly hour")
            value: 2
            hint: _("Hour of the day that monthly backups run.")
            validators:
              min: 0
              max: 23
              patternType: integer
              required: true
            modifiers:
              - type: visible
                constraint:
                  operator: ne
                  arg0:
                    prop: monthly
                  arg1: 0
          - type: numberInput
            name: monthlymin
            label: _("monthly minute")
            value: 30
            hint: _("Minute after the hour that monthly backups run.")
            validators:
              min: 0
              max: 59
              patternType: integer
              required: true
            modifiers:
              - type: visible
                constraint:
                  operator: ne
                  arg0:
                    prop: monthly
                  arg1: 0
      - type: container
        fields:
          - type: numberInput
            name: yearly
            label: _("Retain yearly")
            value: 0
            hint: _("Number of yearly backups to keep.")
            validators:
              min: 0
              max: 99
              patternType: integer
              required: true
          - type: numberInput
            name: yearlyhour
            label: _("yearly hour")
            value: 2
            hint: _("Hour of the day that yearly backups run.")
            validators:
              min: 0
              max: 23
              patternType: integer
              required: true
            modifiers:
              - type: visible
                constraint:
                  operator: ne
                  arg0:
                    prop: yearly
                  arg1: 0
          - type: numberInput
            name: yearlymin
            label: _("yearly minute")
            value: 0
            hint: _("Minute after the hour that yearly backups run.")
            validators:
              min: 0
              max: 59
              patternType: integer
              required: true
            modifiers:
              - type: visible
                constraint:
                  operator: ne
                  arg0:
                    prop: yearly
                  arg1: 0
      - type: divider
        title: _("Maintenance")
      - type: checkbox
        name: compact
        label: _("Run compact after backup and prune")
        value: false
      - type: numberInput
        name: cthreshold
        label: _("Compact threshold")
        value: 10
        hint: _("Set minimum threshold for saved space in percent")
        validators:
          min: 0
          max: 99
          patternType: integer
          required: true
      - type: divider
        title: _("Runtime / Output")
      - type: numberInput
        name: ratelimit
        label: _("Rate limit")
        value: 0
        hint: _("Set remote network upload rate limit in kiByte/s (default&#58; 0=unlimited).")
        validators:
          min: 0
          patternType: integer
          required: true
      - type: checkbox
        name: list
        label: _("List")
        value: true
        hint: _("Output verbose list of files and directories.")
      - type: checkbox
        name: email
        label: _("Email")
        value: true
        hint: _("Checked = send email on error or success.<br/>Unchecked = send email on error only.")
      - type: divider
        title: _("Hooks / Advanced")
      - type: textInput
        name: prescript
        label: _("Pre-script")
        value: ""
        hint: _("Run script from this path before backup.")
      - type: textInput
        name: postscript
        label: _("Post-script")
        value: ""
        hint: _("Run script from this path after backup.")
      - type: textInput
        name: basedir
        label: _("Base Dir")
        hint: _("Base directory to make archive use relative paths. Leave blank to use absolute paths in archive.")
        value: ""
    buttons:
      - template: submit
        execute:
          type: url
          url: "/services/borgbackup/archives"
      - template: cancel
        execute:
          type: url
          url: "/services/borgbackup/archives"
